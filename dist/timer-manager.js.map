{"version":3,"file":"timer-manager.js","sources":["../src/timer-manager.js"],"sourcesContent":["class TimerManager {\n  constructor(workerPath = '/shared-timer-worker.js') {\n    this.worker = null;\n    this.workerPath = workerPath;\n    this.callbacks = new Map();\n    this.isConnected = false;\n    this.init();\n  }\n\n  init() {\n    try {\n      this.worker = new SharedWorker(this.workerPath);\n      this.worker.port.start();\n      \n      this.worker.port.onmessage = (event) => {\n        this.handleWorkerMessage(event.data);\n      };\n\n      this.worker.port.onerror = (error) => {\n        console.error('SharedWorker error:', error);\n      };\n\n      this.isConnected = true;\n    } catch (error) {\n      console.error('Failed to initialize SharedWorker:', error);\n      throw new Error('SharedWorker not supported or failed to initialize');\n    }\n  }\n\n  handleWorkerMessage(data) {\n    const { action, taskName, timestamp } = data;\n\n    switch (action) {\n      case 'TIMER_TICK':\n        const callback = this.callbacks.get(taskName);\n        if (callback) {\n          callback(taskName, timestamp);\n        }\n        break;\n      case 'TASK_CLEARED':\n        // Optionally handle task cleared event\n        break;\n      case 'ALL_TASKS_CLEARED':\n        this.callbacks.clear();\n        break;\n      case 'PONG':\n        // Health check response\n        break;\n    }\n  }\n\n  /**\n   * Add a timer task\n   * @param {string} taskName - Unique name for the task\n   * @param {number} intervalTime - Interval in milliseconds\n   * @param {Function} callback - Function to call on each interval\n   * @param {boolean} canRepeat - Whether the task should repeat (default: true)\n   */\n  addTimerTask(taskName, intervalTime, callback, canRepeat = true) {\n    if (!this.isConnected) {\n      throw new Error('TimerManager is not connected to SharedWorker');\n    }\n\n    if (typeof callback !== 'function') {\n      throw new Error('Callback must be a function');\n    }\n\n    if (typeof intervalTime !== 'number' || intervalTime <= 0) {\n      throw new Error('Interval time must be a positive number');\n    }\n\n    // Store the callback\n    this.callbacks.set(taskName, callback);\n\n    // Send message to worker\n    this.worker.port.postMessage({\n      action: 'ADD_TASK',\n      taskName,\n      intervalTime,\n      canRepeat\n    });\n  }\n\n  /**\n   * Clear a specific timer task\n   * @param {string} taskName - Name of the task to clear\n   */\n  clearTimerTask(taskName) {\n    if (!this.isConnected) {\n      throw new Error('TimerManager is not connected to SharedWorker');\n    }\n\n    this.callbacks.delete(taskName);\n    this.worker.port.postMessage({\n      action: 'CLEAR_TASK',\n      taskName\n    });\n  }\n\n  /**\n   * Remove all timer tasks\n   */\n  removeAllTimerTasks() {\n    if (!this.isConnected) {\n      throw new Error('TimerManager is not connected to SharedWorker');\n    }\n\n    this.callbacks.clear();\n    this.worker.port.postMessage({\n      action: 'REMOVE_ALL'\n    });\n  }\n\n  /**\n   * Check if worker is connected\n   * @param {string} taskName - Optional task name for ping\n   * @returns {boolean} Connection status\n   */\n  ping(taskName = 'health-check') {\n    if (!this.isConnected) {\n      return false;\n    }\n\n    this.worker.port.postMessage({\n      action: 'PING',\n      taskName\n    });\n    return true;\n  }\n\n  /**\n   * Get list of active task names\n   * @returns {Array<string>} Array of task names\n   */\n  getActiveTasks() {\n    return Array.from(this.callbacks.keys());\n  }\n\n  /**\n   * Check if a task exists\n   * @param {string} taskName - Name of the task\n   * @returns {boolean} Whether the task exists\n   */\n  hasTask(taskName) {\n    return this.callbacks.has(taskName);\n  }\n}\n\n// Export for ES modules\nexport default TimerManager;\n\n// Also support CommonJS\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = TimerManager;\n}"],"names":[],"mappings":"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"}