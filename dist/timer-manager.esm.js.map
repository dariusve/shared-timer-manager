{"version":3,"file":"timer-manager.esm.js","sources":["../src/timer-manager.js"],"sourcesContent":["class TimerManager {\n  constructor(workerPath = '/shared-timer-worker.js') {\n    this.worker = null;\n    this.workerPath = workerPath;\n    this.callbacks = new Map();\n    this.isConnected = false;\n    this.init();\n  }\n\n  init() {\n    try {\n      this.worker = new SharedWorker(this.workerPath);\n      this.worker.port.start();\n      \n      this.worker.port.onmessage = (event) => {\n        this.handleWorkerMessage(event.data);\n      };\n\n      this.worker.port.onerror = (error) => {\n        console.error('SharedWorker error:', error);\n      };\n\n      this.isConnected = true;\n    } catch (error) {\n      console.error('Failed to initialize SharedWorker:', error);\n      throw new Error('SharedWorker not supported or failed to initialize');\n    }\n  }\n\n  handleWorkerMessage(data) {\n    const { action, taskName, timestamp } = data;\n\n    switch (action) {\n      case 'TIMER_TICK':\n        const callback = this.callbacks.get(taskName);\n        if (callback) {\n          callback(taskName, timestamp);\n        }\n        break;\n      case 'TASK_CLEARED':\n        // Optionally handle task cleared event\n        break;\n      case 'ALL_TASKS_CLEARED':\n        this.callbacks.clear();\n        break;\n      case 'PONG':\n        // Health check response\n        break;\n    }\n  }\n\n  /**\n   * Add a timer task\n   * @param {string} taskName - Unique name for the task\n   * @param {number} intervalTime - Interval in milliseconds\n   * @param {Function} callback - Function to call on each interval\n   * @param {boolean} canRepeat - Whether the task should repeat (default: true)\n   */\n  addTimerTask(taskName, intervalTime, callback, canRepeat = true) {\n    if (!this.isConnected) {\n      throw new Error('TimerManager is not connected to SharedWorker');\n    }\n\n    if (typeof callback !== 'function') {\n      throw new Error('Callback must be a function');\n    }\n\n    if (typeof intervalTime !== 'number' || intervalTime <= 0) {\n      throw new Error('Interval time must be a positive number');\n    }\n\n    // Store the callback\n    this.callbacks.set(taskName, callback);\n\n    // Send message to worker\n    this.worker.port.postMessage({\n      action: 'ADD_TASK',\n      taskName,\n      intervalTime,\n      canRepeat\n    });\n  }\n\n  /**\n   * Clear a specific timer task\n   * @param {string} taskName - Name of the task to clear\n   */\n  clearTimerTask(taskName) {\n    if (!this.isConnected) {\n      throw new Error('TimerManager is not connected to SharedWorker');\n    }\n\n    this.callbacks.delete(taskName);\n    this.worker.port.postMessage({\n      action: 'CLEAR_TASK',\n      taskName\n    });\n  }\n\n  /**\n   * Remove all timer tasks\n   */\n  removeAllTimerTasks() {\n    if (!this.isConnected) {\n      throw new Error('TimerManager is not connected to SharedWorker');\n    }\n\n    this.callbacks.clear();\n    this.worker.port.postMessage({\n      action: 'REMOVE_ALL'\n    });\n  }\n\n  /**\n   * Check if worker is connected\n   * @param {string} taskName - Optional task name for ping\n   * @returns {boolean} Connection status\n   */\n  ping(taskName = 'health-check') {\n    if (!this.isConnected) {\n      return false;\n    }\n\n    this.worker.port.postMessage({\n      action: 'PING',\n      taskName\n    });\n    return true;\n  }\n\n  /**\n   * Get list of active task names\n   * @returns {Array<string>} Array of task names\n   */\n  getActiveTasks() {\n    return Array.from(this.callbacks.keys());\n  }\n\n  /**\n   * Check if a task exists\n   * @param {string} taskName - Name of the task\n   * @returns {boolean} Whether the task exists\n   */\n  hasTask(taskName) {\n    return this.callbacks.has(taskName);\n  }\n}\n\n// Export for ES modules\nexport default TimerManager;\n\n// Also support CommonJS\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = TimerManager;\n}"],"names":[],"mappings":"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"}